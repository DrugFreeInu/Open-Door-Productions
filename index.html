<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DFI World Snow Pan</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: black;
      touch-action: none;
    }

    /* ===== Viewport (camera) ===== */
    .viewport {
      position: fixed;
      inset: 0;
      overflow: hidden;
    }

    /* ===== Backstage (ALWAYS EXISTS) ===== */
    .backstage {
      position: absolute;
      inset: 0;
      background: black;
      z-index: 0;
    }

    /* ===== Scene (moves) ===== */
    .pan-layer {
      position: absolute;
      top: 0;
      left: 0;
      height: 100vh;
      z-index: 1;
      will-change: transform;
      transform: translateX(0);
      cursor: grab;
    }

    .pan-layer:active {
      cursor: grabbing;
    }

    .bg-image {
      height: 100vh;
      width: auto;
      display: block;
      user-select: none;
      pointer-events: none;
    }

    /* ===== World-space snow ===== */
    .snow-canvas {
      position: absolute;
      top: 0;
      left: 0;
      height: 100vh;
      pointer-events: none;
    }
  </style>
</head>

<body>

  <div class="viewport">

    <!-- Backstage layer (behind everything) -->
    <div class="backstage"></div>

    <!-- Moving world -->
    <div class="pan-layer" id="pan">

      <!-- Background image -->
      <img
        id="bg"
        class="bg-image"
        src="E85291DD-8424-44F6-B1B1-B6FA7CEAB9E0.png"
        draggable="false"
      >

      <!-- Snow lives IN the scene -->
      <canvas id="snow" class="snow-canvas"></canvas>

    </div>
  </div>

  <script>
    /* ======================
       PAN LOGIC
    ====================== */
    const pan = document.getElementById("pan");

    let x = 0;
    let startX = 0;
    let dragging = false;

    window.addEventListener("wheel", (e) => {
      e.preventDefault();
      x -= e.deltaY;
      pan.style.transform = `translateX(${x}px)`;
    }, { passive: false });

    window.addEventListener("touchstart", (e) => {
      dragging = true;
      startX = e.touches[0].clientX;
    }, { passive: true });

    window.addEventListener("touchmove", (e) => {
      if (!dragging) return;
      const dx = e.touches[0].clientX - startX;
      pan.style.transform = `translateX(${x + dx}px)`;
    }, { passive: true });

    window.addEventListener("touchend", (e) => {
      if (!dragging) return;
      const dx = e.changedTouches[0].clientX - startX;
      x += dx;
      dragging = false;
    });

    /* ======================
       WORLD SNOW
    ====================== */
    const img = document.getElementById("bg");
    const canvas = document.getElementById("snow");
    const ctx = canvas.getContext("2d");

    let particles = [];

    function resizeSnow() {
      canvas.width = img.offsetWidth;
      canvas.height = window.innerHeight;

      particles = Array.from({ length: 400 }, () => ({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        r: Math.random() * 2 + 1,
        d: Math.random() * 1 + 0.5
      }));
    }

    img.onload = resizeSnow;
    window.addEventListener("resize", resizeSnow);

    function drawSnow() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "white";
      ctx.beginPath();

      for (const p of particles) {
        ctx.moveTo(p.x, p.y);
        ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);

        p.y += p.d;

        if (p.y > canvas.height) {
          p.y = -5;
          p.x = Math.random() * canvas.width;
        }
      }

      ctx.fill();
      requestAnimationFrame(drawSnow);
    }

    drawSnow();
  </script>

</body>
</html>
