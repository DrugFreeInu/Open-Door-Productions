<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DFI World Snow Pan</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: black;
      touch-action: none;
    }

    .viewport {
      position: fixed;
      inset: 0;
      overflow: hidden;
    }

    .backstage {
      position: absolute;
      inset: 0;
      background: black;
      z-index: 0;
    }

    .code-layer {
      position: absolute;
      inset: 0;
      border: none;
      background: transparent;
      z-index: 0;
      pointer-events: none;
    }

    .pan-layer {
      position: absolute;
      top: 0;
      left: 0;
      height: 100vh;
      z-index: 1;
      will-change: transform;
      cursor: grab;
    }

    .pan-layer:active {
      cursor: grabbing;
    }

    .bg-image {
      height: 100vh;
      width: auto;
      display: block;
      user-select: none;
      pointer-events: none;
    }

    .snow-canvas {
      position: absolute;
      top: 0;
      left: 0;
      height: 100vh;
      pointer-events: none;
    }
  </style>
</head>

<body>

<div class="viewport">

  <div class="backstage"></div>

  <iframe src="code.html" class="code-layer" tabindex="-1"></iframe>

  <div class="pan-layer" id="pan">
    <img
      id="bg"
      class="bg-image"
      src="E85291DD-8424-44F6-B1B1-B6FA7CEAB9E0.png"
      draggable="false"
    >
    <canvas id="snow" class="snow-canvas"></canvas>
  </div>
</div>

<script>
  /* ======================
     SMOOTH BUT DIRECT PAN
  ====================== */
  const pan = document.getElementById("pan");

  let targetX = 0;
  let renderX = 0;

  let startX = 0;
  let baseX = 0;
  let dragging = false;

  const smooth = 0.18; // higher = tighter / more direct

  /* Wheel */
  window.addEventListener("wheel", (e) => {
    e.preventDefault();
    targetX -= e.deltaY;
  }, { passive: false });

  /* Touch */
  window.addEventListener("touchstart", (e) => {
    dragging = true;
    startX = e.touches[0].clientX;
    baseX = targetX;
  }, { passive: true });

  window.addEventListener("touchmove", (e) => {
    if (!dragging) return;
    const dx = e.touches[0].clientX - startX;
    targetX = baseX + dx;
  }, { passive: true });

  window.addEventListener("touchend", () => {
    dragging = false;
  });

  /* Render loop */
  function animate() {
    renderX += (targetX - renderX) * smooth;
    pan.style.transform = `translateX(${renderX}px)`;
    requestAnimationFrame(animate);
  }

  animate();

  /* ======================
     WORLD SNOW
  ====================== */
  const img = document.getElementById("bg");
  const canvas = document.getElementById("snow");
  const ctx = canvas.getContext("2d");

  let particles = [];

  function resizeSnow() {
    canvas.width = img.offsetWidth;
    canvas.height = window.innerHeight;

    particles = Array.from({ length: 400 }, () => ({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: Math.random() * 2 + 1,
      d: Math.random() * 1 + 0.5
    }));
  }

  img.onload = resizeSnow;
  window.addEventListener("resize", resizeSnow);

  function drawSnow() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "white";
    ctx.beginPath();

    for (const p of particles) {
      ctx.moveTo(p.x, p.y);
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      p.y += p.d;

      if (p.y > canvas.height) {
        p.y = -5;
        p.x = Math.random() * canvas.width;
      }
    }

    ctx.fill();
    requestAnimationFrame(drawSnow);
  }

  drawSnow();
</script>

</body>
</html>
